<a href="equations page.html" style="display:inline-block; margin-bottom:10px; color:blue; text-decoration:none;">üìñ Voir les √©quations</a>
<a href="TP.html" style="display:inline-block; margin-bottom:10px; color:blue; text-decoration:none;">üìñ Voir √âtapes du TP et les Questions</a>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Simulation Effet Photo√©lectrique - Circuit Exact</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; background:#f5f5f5; padding:20px; }
h2 { margin-bottom:10px; }
.panel { display:inline-block; background:white; padding:20px; border-radius:12px; border:1px solid #ccc; }
label { display:block; margin:12px 0; }
input[type=range], select { width:320px; }
canvas { border:1px solid #aaa; background:#fff; border-radius:8px; margin-top:20px; }
table { margin:20px auto; border-collapse:collapse; }
th, td { border:1px solid #aaa; padding:6px 10px; }
button { margin:5px; padding:6px 10px; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>

<h2>TP Effet Photo√©lectrique by Prof. AL KWATLI ‚Äì Simulation Interactive </h2>

<div class="panel">
<label>
Longueur d‚Äôonde Œª (nm):
<span id="lambda_val">500</span> nm
<input type="range" id="lambda" min="200" max="800" step="10" value="500">
</label>

<label>
M√©tal (fonction travail Œ¶ en eV):
<select id="metal">
  <option value="2.3">Sodium (Œ¶=2.3 eV)</option>
  <option value="2.9">Calcium (Œ¶=2.9 eV)</option>
  <option value="4.3">Zinc (Œ¶=4.3 eV)</option>
  <option value="4.7">Cuivre (Œ¶=4.7 eV)</option>
  <option value="4.1">Aluminium (Œ¶=4.1 eV)</option>
  <option value="4.7">Argent (Œ¶=4.7 eV)</option>
  <option value="5.1">Or (Œ¶=5.1 eV)</option>
</select>
</label>

<div id="info"></div>

<button onclick="startSimulation()">‚ñ∂ Start</button>
<button onclick="stopSimulation()">‚è∏ Stop</button>
<button onclick="restartSimulation()">üîÑ Restart</button>

<canvas id="canvas" width="900" height="500"></canvas>

<button onclick="recordData()">üìä Enregistrer la mesure</button>

<table id="dataTable">
<tr>
<th>Œª (nm)</th><th>ŒΩ (10¬π‚Å¥ Hz)</th><th>EŒ≥ (eV)</th>
<th>M√©tal</th><th>Œ¶ (eV)</th><th>LED</th>
</tr>
</table>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const lambdaSlider = document.getElementById("lambda");
const lambdaVal = document.getElementById("lambda_val");
const metalSelect = document.getElementById("metal");
const infoBox = document.getElementById("info");
const dataTable = document.getElementById("dataTable");

const c = 3e8;
const h_J = 6.626e-34;
const eV = 1.602e-19;

let photons = [];
let electrons = [];
const photonSpeed = 5;
const electronSpeed = 1;

let animationRunning = false;
let photonInterval;

// Points cl√©s du circuit
const pointsCircuit = [
  {x:460, y:190}, // d√©part m√©tal
  {x:650, y:190}, // bas LED
  {x:650, y:130}, // haut LED
  {x:460, y:130}, // haut m√©tal
  {x:460, y:190}  // retour m√©tal
];

function computeValues(){
  const lambda_nm = parseFloat(lambdaSlider.value);
  const lambda_m = lambda_nm*1e-9;
  const nu = c/lambda_m;
  const E = h_J*nu/eV;
  const phi = parseFloat(metalSelect.value);
  return {lambda_nm, nu, E, phi};
}

function addPhoton(){
  const {E} = computeValues();
  photons.push({x:100, y:200, color:E<2.5?"red":E<3.5?"yellow":"blue", hit:false});
}

function updateInfo(){
  const {lambda_nm, nu, E, phi} = computeValues();
  lambdaVal.textContent = lambda_nm;
  infoBox.innerHTML = 
    `<strong>Œª = ${lambda_nm} nm</strong><br>`+
    `<strong>ŒΩ = ${(nu/1e14).toFixed(2)} √ó10¬π‚Å¥ Hz</strong><br>`+
    `<strong>E = ${E.toFixed(2)} eV</strong><br>`+
    `<strong>Œ¶ (m√©tal choisi) = ${phi.toFixed(2)} eV</strong>`;
}

function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const {phi} = computeValues();
  let ledOn = electrons.some(e=>e.currentPoint===1);

  // Circuit
  ctx.strokeStyle="black"; ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(pointsCircuit[0].x,pointsCircuit[0].y);
  for(let i=1;i<pointsCircuit.length;i++){
    ctx.lineTo(pointsCircuit[i].x,pointsCircuit[i].y);
  }
  ctx.stroke();

  // M√©tal
  ctx.fillStyle="#888";
  ctx.fillRect(pointsCircuit[0].x-20, pointsCircuit[0].y-20, 80, 80);

  // LED
  ctx.beginPath();
  ctx.arc(pointsCircuit[1].x, pointsCircuit[1].y, 35, 0, Math.PI*2);
  ctx.stroke();
  ctx.fillStyle=ledOn?"limegreen":"gray";
  ctx.shadowColor = ledOn?"limegreen":""; 
  ctx.shadowBlur = ledOn?20:0;
  ctx.fill();
  ctx.shadowBlur=0;

  // Source lumi√®re
  ctx.fillStyle="orange";
  ctx.beginPath();
  ctx.arc(50,200,30,0,Math.PI*2);
  ctx.fill();

  // D√©placer photons
  for(let i=photons.length-1;i>=0;i--){
    let p=photons[i];
    let dx=pointsCircuit[0].x- p.x;
    let dy=pointsCircuit[0].y- p.y;
    let dist=Math.sqrt(dx*dx + dy*dy);
    let vx=(dx/dist)*photonSpeed;
    let vy=(dy/dist)*photonSpeed;
    p.x+=vx; p.y+=vy;

    ctx.strokeStyle=p.color;
    ctx.beginPath();
    ctx.moveTo(p.x-2*vx,p.y-2*vy);
    ctx.lineTo(p.x,p.y);
    ctx.stroke();

    if(!p.hit && p.x>=pointsCircuit[0].x-20 && p.x<=pointsCircuit[0].x+60 &&
       p.y>=pointsCircuit[0].y-20 && p.y<=pointsCircuit[0].y+60){
      p.hit=true;
      const {E} = computeValues();
      if(E>=phi){
        electrons.push({x:pointsCircuit[0].x, y:pointsCircuit[0].y, currentPoint:0});
      }
    }
    if(p.x>900 || p.y>500) photons.splice(i,1);
  }

  // D√©placer √©lectrons
  for(let i=electrons.length-1;i>=0;i--){
    let e=electrons[i];
    let nextPoint=pointsCircuit[e.currentPoint+1];
    if(nextPoint){
      let dx=nextPoint.x - e.x;
      let dy=nextPoint.y - e.y;
      let dist=Math.sqrt(dx*dx+dy*dy);
      let vx=(dx/dist)*electronSpeed;
      let vy=(dy/dist)*electronSpeed;

      e.x+=vx; e.y+=vy;

      if(dist<electronSpeed){
        e.x=nextPoint.x; e.y=nextPoint.y;
        e.currentPoint++;
      }
    } else electrons.splice(i,1);

    // Dessiner √©lectron
    ctx.fillStyle="blue";
    ctx.beginPath();
    ctx.arc(e.x,e.y,4,0,Math.PI*2);
    ctx.fill();
  }

  // L√©gendes √©loign√©es
  ctx.fillStyle="black";
  ctx.font="16px Arial";
  ctx.fillText("Photon (couleur = selon l'√©nergie)", 80, 185);
  ctx.fillText("√âlectron (cercle bleu)", 500, 100);
  ctx.fillText("M√©tal", 390, 250);
  ctx.fillText("LED = courant √©lectrique", 700, 200);
  ctx.fillText("Source lumi√®re", 50, 250);

  if(animationRunning) requestAnimationFrame(animate);
}

// Boutons
function startSimulation(){ 
  if(!animationRunning){ 
    animationRunning=true; 
    animate(); 
    photonInterval=setInterval(addPhoton,700); 
  } 
}
function stopSimulation(){ 
  animationRunning=false; 
  clearInterval(photonInterval);
}
function restartSimulation(){ 
  photons=[]; electrons=[]; 
  animationRunning=false; 
  clearInterval(photonInterval); 
  ctx.clearRect(0,0,canvas.width,canvas.height);
}
function recordData(){ 
  const {lambda_nm, nu, E, phi} = computeValues(); 
  const row=document.createElement("tr"); 
  row.innerHTML=`<td>${lambda_nm}</td><td>${(nu/1e14).toFixed(2)}</td><td>${E.toFixed(2)}</td><td>${metalSelect.options[metalSelect.selectedIndex].text}</td><td>${phi}</td><td>${electrons.some(e=>e.currentPoint>=1)?"ON":"OFF"}</td>`; 
  dataTable.appendChild(row); 
}

lambdaSlider.addEventListener("input",updateInfo);
metalSelect.addEventListener("change",updateInfo);
updateInfo();
</script>
</body>
</html>
